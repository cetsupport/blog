+++
categories = [ "Version Control System" ]
date = "2015-12-28T01:05:29-07:00"
draft = false
eyecatch = "git.png"
slug = "git-merge"
tags = [ "git" ]
title = "Gitのマージを図解する"
+++

このエントリでは、[__Git__](https://git-scm.com/)が提供するマージのための機能の内、主なもの4つ、__普通のマージ__、__リベース__、__ファストフォワードマージ__、__チェリーピック__ について図解する。
ここでマージとは、とあるブランチのコミットが入れた修正を別のブランチに取り込むこととする。

[この記事](http://tbd.kaitoy.xyz/2015/12/27/git-repository/)を事前に呼んでおくとわかりやすいかもしれない。

ここで説明するマージは全てローカルリポジトリ内のブランチを操作対象とする。

## 普通のマージ
普通のマージは、複数のブランチでそれぞれ開発が進んでいて、つまりそれぞれのコミットグラフが伸びている場合に、それらの修正を統合するときに実行する。
マージするブランチはいくつでも指定できる。

基本的なコマンドは`git merge <ブランチ>...`。

操作に成功すると、マージ後のプロジェクトの状態を表すコミット(マージコミット)が作られ、カレントブランチの先頭に追加される。
マージコミットは、マージした全てのブランチが指していたコミットを親として持つ。

このマージはマージコミットを追加するだけであり、既存のコミットを一切変更しないことを認識しておくべし。

以下、普通のマージの実行例を図示する。

<ul class="bxslider">
  <li><img src="/images/git-merge/git_merge/スライド1.PNG" /></li>
  <li><img src="/images/git-merge/git_merge/スライド2.PNG" /></li>
  <li><img src="/images/git-merge/git_merge/スライド3.PNG" /></li>
  <li><img src="/images/git-merge/git_merge/スライド4.PNG" /></li>
</ul>

## リベース
リベースは、あるブランチで作った一連のコミットの起点(ベース)を移動したいときに実行する。
この操作は一般的にはマージとは呼ばれないが、冒頭に書いたマージの定義からするとマージと見なせないこともないのでここに挙げる。

基本的なコマンドは`git rebase <ブランチ>`。

操作に成功すると、リベースしたブランチにもともとあったコミットは消え、それと同等の修正をもたらす別のコミットが`HEAD`を起点として作成される。

リベースは既存のコミットを消し、コミットグラフを変更てしまうということを認識しておくべし。

以下、リベースの簡単な実行例を図示する。

<ul class="bxslider">
  <li><img src="/images/git-merge/git_rebase/スライド1.PNG" /></li>
  <li><img src="/images/git-merge/git_rebase/スライド2.PNG" /></li>
</ul>

<br>

上のスライドのように単純なコミットグラフならいいが、リベースするブランチが分岐していたりするとややこしいことが起き得る。
そういうケースには[O'Reillyの蝙蝠本](https://www.oreilly.co.jp/books/9784873114408/)などでよく勉強してから臨むべし。

## ファストフォワードマージ
ファストフォワードマージは、マージ先のコミットが全てマージ元に含まれているときに使えるマージ。
この操作は既存のコミットグラフをいじらないしマージコミットも作らない特殊なマージ。
(実のところマージじゃないと言ってもいい。)
このマージを実行した後は、コミットグラフは一直線になり、ブランチを作らずにコミットを作った場合と同様になる。

このマージは、`git rebase <ブランチ>`を実行したときに可能であれば実行される。
(でなければ普通のマージが実行される。オプションで選択することもできる。)

以下にファストフォワードマージの例を図示する。

<ul class="bxslider">
  <li><img src="/images/git-merge/git_ff/スライド1.PNG" /></li>
  <li><img src="/images/git-merge/git_ff/スライド2.PNG" /></li>
</ul>

<br>

ファストフォワードマージはよくリベースとともに実行される。
リベースのスライドの最後のページの図は、ここのスライドの最初のページの図と同じになっている。

リベース + ファストフォワードは、トピックブランチで入れた修正を、そのブランチを作ったという履歴を残さずに別のブランチに取り入れたいときなどに使う手法。
マージコミットを作る手法よりもコミットグラフをシンプルに保てる。

## チェリーピック
チェリーピックは、あるブランチの任意のコミットによる修正を別のブランチに取り込みたいときに実行する。
他の3つのマージに比べて分かりやすい操作であり、また操作対象にするブランチやコミットの自由度が高いので使いやすい。
その反面、コミットログなどに明記しないとどこのコミットをマージしたのかが分からなくなる。

基本的なコマンドは`git cherry-pick <コミット>`。

操作に成功すると、指定したコミットと同等の修正をもたらす新しいコミットが作成され、`HEAD`に追加される。

この操作はコミットを追加するだけであり、既存のコミットは変更しない。

以下にチェリーピックの例を図示する。

<ul class="bxslider">
  <li><img src="/images/git-merge/git_cherry-pick/スライド1.PNG" /></li>
  <li><img src="/images/git-merge/git_cherry-pick/スライド2.PNG" /></li>
</ul>
